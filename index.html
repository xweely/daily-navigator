<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Navigator</title>
    <style>
        body { 
            margin: 0; 
            background: #90EE90; 
            color: #000; 
            font-family: sans-serif; 
            height: 100vh; 
            display: flex; 
            flex-direction: column;
            user-select: none; 
        }
        /* Header section stays at the top */
        #header {
            padding-top: 20px;
            text-align: center;
            flex-shrink: 0;
        }
        #date-display { font-size: 1.1rem; font-weight: bold; opacity: 0.7; }
        #time-display { font-size: 2.2rem; font-weight: 900; margin-top: 5px; }

        /* Content section stays perfectly centered */
        #content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding-bottom: 60px; /* Offset for the hint text */
        }
        #step-info { font-size: 1.4rem; font-weight: bold; opacity: 0.6; text-transform: uppercase; letter-spacing: 1px; }
        #task { font-size: 3.8rem; font-weight: 900; margin: 15px 25px; line-height: 1.1; }
        
        #hint { position: fixed; bottom: 30px; width: 100%; text-align: center; font-weight: bold; opacity: 0.4; font-size: 0.9rem; }
    </style>
</head>
<body onclick="nextStep()">
    <div id="header">
        <div id="date-display">0000-00-00 (-)</div>
        <div id="time-display">00:00 AM</div>
    </div>

    <div id="content">
        <div id="step-info">Step 1</div>
        <div id="task">Loading...</div>
    </div>

    <div id="hint">Tap anywhere to continue</div>

    <script>
        const routines = [
            { start: "00:00", end: "12:00", steps: ["Drink warm water", "Take Duspatalin", "Milk, chia seed mixture", "Toilet", "Exercise", "Close eyes and breathe"] },
            { start: "13:00", end: "14:30", steps: ["Take Visanne", "Drink water", "Neck exercise"] },
            { start: "15:30", end: "16:40", steps: ["Drink milk"] },
            { start: "16:41", end: "17:30", steps: ["Drink water", "Lie Down Exercise", "Left leg bend", "Child's pose", "Cat's stretch"] },
            { start: "17:31", end: "18:14", steps: ["Back exercise", "Walk in park"] },
            { start: "18:15", end: "19:00", steps: ["Drink water", "Take Duspatalin"] },
            { start: "19:30", end: "20:30", steps: ["Drink Apple cider water"] },
            { start: "20:31", end: "21:20", steps: ["Bath"] },
            { start: "21:21", end: "22:00", steps: ["Drink water", "Prepare hot water", "Eat a bit"] },
            { start: "22:01", end: "23:30", steps: ["On bed"] }
        ];
        
        const standardRecovery = ["Drink water", "Neck exercise", "Close eyes and Breathe"];
        const defaultSteps = ["Drink water", "Neck exercise", "Close eyes and Breathe"];
        
        let currentSteps = [];
        let index = 0;

        function updateDateTime() {
            const now = new Date();
            const days = ['日', '一', '二', '三', '四', '五', '六'];
            const dateStr = now.getFullYear() + '-' + 
                            String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                            String(now.getDate()).padStart(2, '0') + 
                            ' (' + days[now.getDay()] + ')';
            document.getElementById('date-display').innerText = dateStr;

            let hours = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;
            document.getElementById('time-display').innerText = hours + ':' + minutes + ' ' + ampm;
        }

        function init() {
            updateDateTime();
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            const found = routines.find(r => currentTime >= r.start && currentTime <= r.end);
            
            if (found) {
                // Keep morning routine as is, otherwise add recovery steps if missing
                if (found.start === "00:00") {
                    currentSteps = found.steps;
                } else {
                    currentSteps = [...found.steps];
                    standardRecovery.forEach(step => {
                        if (!currentSteps.includes(step)) {
                            currentSteps.push(step);
                        }
                    });
                }
            } else {
                currentSteps = defaultSteps;
            }
            render();
        }

        function render() {
            if (index < currentSteps.length) {
                document.getElementById('task').innerText = currentSteps[index];
                document.getElementById('step-info').innerText = `Step ${index + 1} of ${currentSteps.length}`;
            } else {
                document.getElementById('task').innerText = "All Done";
                document.getElementById('step-info').innerText = "Rest";
            }
        }

        function nextStep() {
            if (index < currentSteps.length) { 
                index++; 
                render(); 
                if (navigator.vibrate) navigator.vibrate(50); 
            } else { 
                index = 0; 
                init(); 
            }
        }

        setInterval(updateDateTime, 10000);
        init();
    </script>
</body>
</html>
